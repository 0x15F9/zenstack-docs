---
sidebar_label: 3. The ZenStack CLI
---

import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';

# The "zenstack" CLI

The `zenstack` CLI is the main tool for using ZenStack in a project. The CLI is intentionally designed to have some similar commands to the `prisma` CLI.

Let's see how to accomplish some common tasks with it. You can find the full documentation in the [CLI reference guide](/docs/reference/cli).

### Initializing a Project

You can initialize an existing Prisma project using the `zenstack init` command:

```bash
npx zenstack@latest init
```

It does the following things for you:
1. Installs the `zenstack` CLI package as a dev dependency
2. Installs the `@zenstackhq/runtime` package
3. Copies the `prisma/schema.prisma` file to `schema.zmodel` if it exists

If you have a special project setup that the "init" command doesn't work with, you can always manually complete the steps above.

After the initialization, please remember that moving forward you should edit the `schema.zmodel`. The `prisma/schema.prisma` file will be automatically regenerated when you run `zenstack generate`.

The easiest way to scaffold a simple ZenStack project from scratch is by chaining the `try-prisma` and the `zenstack init` command:

```bash
npx try-prisma@latest -p . -n my-zenstack -t typescript/script --install npm
cd my-zenstack
npx zenstack@latest init
```

Give it a try. It should create a new ZenStack project under "my-zenstack" folder, including a simple `schema.zmodel` in it. We'll use the project to try out other commands later.

### Generating Artifacts

The CLI command you'll most often use is `zenstack generate`. It runs the plugins (including the built-in ones that are automatically enabled and the ones you explicitly put into ZModel) to generate various artifacts.

```bash
npx zenstack generate
```

The most important artifact is the Prisma schema. It's generated by the built-in `@core/prisma` plugin, by default into the `prisma/schema.prisma` file. The plugin also runs `prisma generate` automatically to regenerate the Prisma Client.

In the project that we created in the previous section, make the following changes to `schema.zmodel`:

```diff title='schema.zmodel'
model User {
    id Int @id @default(autoincrement())
    email String @unique
    name String?
    posts Post[]
+   profile Profile?
}

+ model Profile {
+     id Int @id @default(autoincrement())
+     bio String?
+     user User @relation(fields: [userId], references: [id])
+     userId Int @unique
+ }
```

Then run:

```bash
npx zenstack generate
```

```
‚åõÔ∏è ZenStack CLI vx.y.z, running plugins
‚úî Running plugin Prisma
‚úî Running plugin Model Metadata
‚úî Running plugin Access Policy

üëª All plugins completed successfully!
Don't forget to restart your dev server to let the changes take effect.
```

You should see that a bunch of plugins are run. When it completes, the `prisma/schema.prisma` file should be updated with the new `Profile` model. You can also use the `Profile` model in your TS code now since the Prisma Client code is also regenerated.

### Listing Installed ZenStack Packages

ZenStack provides multiple NPM packages that implement either plugins or runtime functionalities. The `zenstack` and `@zenstackhq/runtime` packages are almost always needed. The other packages are optional and can be installed based on your needs.

When you upgrade ZenStack, it's important to keep all package versions in sync to avoid unexpected results. The `zenstack info` command can help you list all installed ZenStack packages and their versions. It also checks and prompts if there're newer versions available.

Try running it in our project:

```bash
npx zenstack info
```

```
Installed ZenStack Packages:
    zenstack                    x.y.z
    @zenstackhq/runtime         x.y.z
‚úî Checking npm registry
You are using the latest version of Zenstack.
```

### What About Migration?

The ZenStack CLI is not meant for replacing the Prisma CLI. After `zenstack generate` generates the Prisma schema, you can use the Prisma CLI as you normally do to complete tasks like:

- Creating migration records with `prisma migrate dev`
- Pushing schema changes to the db with `prima db push`
- Launching Prisma Studio with `prisma studio`
- ...

The Prisma development workflow that you're already familiar with should work seamlessly with ZenStack.

<ThemedImage
    alt="ZModel Generation"
    sources={{
        light: useBaseUrl('/img/intro/zmodel-generation-light.png'),
        dark: useBaseUrl('/img/intro/zmodel-generation-dark.png'),
    }}
/>
